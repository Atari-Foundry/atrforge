name: CI

# CI workflow for basic verification
# All builds are done locally - see CONTRIBUTING.md for build instructions
#
# Configuration:
#   MAIN_BRANCH     - Main branch name (default: "main")
#   DEVELOP_BRANCH  - Develop branch name (default: "develop")
#   BUILD_DIR       - Build output directory (default: "obj")
#   TEST_COMMAND    - Test command (default: empty)

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  verify:
    name: Verify (Linux)
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        compiler: [gcc, clang]
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up compiler
      run: |
        if [ "${{ matrix.compiler }}" = "clang" ]; then
          sudo apt-get update
          sudo apt-get install -y clang
        fi
    
    - name: Build
      run: |
        if [ "${{ matrix.compiler }}" = "clang" ]; then
          make CC=clang
        else
          make
        fi
    
    - name: Verify binaries
      run: |
        test -f bin/atrforge
        test -f bin/lsatr
        test -f bin/convertatr
        test -f bin/atrcp
        echo "âœ“ All binaries built successfully"
    
    - name: Run tests
      run: make test
      continue-on-error: true
    
    - name: Check executables
      run: |
        ./bin/atrforge -h || true
        ./bin/lsatr -h || true
        ./bin/convertatr -h || true
        ./bin/atrcp -h || true
